(()=>{"use strict";var e,r,t={265:(e,r,t)=>{t.r(r),t.d(r,{default:()=>u});var n=t(81),a=t.n(n),i=t(645),o=t.n(i)()(a());o.push([e.id,"body{\r\n    background-color: #c0c0c0;\r\n    padding: 0px;\r\n    margin: 0px;\r\n}\r\n#webgl{\r\n    background-color: #000000;\r\n}\r\n\r\n#test{\r\n    background-color: rgb(238, 54, 54);\r\n}",""]);const u=o},645:e=>{e.exports=function(e){var r=[];return r.toString=function(){return this.map((function(r){var t="",n=void 0!==r[5];return r[4]&&(t+="@supports (".concat(r[4],") {")),r[2]&&(t+="@media ".concat(r[2]," {")),n&&(t+="@layer".concat(r[5].length>0?" ".concat(r[5]):""," {")),t+=e(r),n&&(t+="}"),r[2]&&(t+="}"),r[4]&&(t+="}"),t})).join("")},r.i=function(e,t,n,a,i){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(n)for(var u=0;u<this.length;u++){var c=this[u][0];null!=c&&(o[c]=!0)}for(var s=0;s<e.length;s++){var f=[].concat(e[s]);n&&o[f[0]]||(void 0!==i&&(void 0===f[5]||(f[1]="@layer".concat(f[5].length>0?" ".concat(f[5]):""," {").concat(f[1],"}")),f[5]=i),t&&(f[2]?(f[1]="@media ".concat(f[2]," {").concat(f[1],"}"),f[2]=t):f[2]=t),a&&(f[4]?(f[1]="@supports (".concat(f[4],") {").concat(f[1],"}"),f[4]=a):f[4]="".concat(a)),r.push(f))}},r}},81:e=>{e.exports=function(e){return e[1]}},643:(e,r,t)=>{var n=t(379),a=t.n(n),i=t(795),o=t.n(i),u=t(569),c=t.n(u),s=t(565),f=t.n(s),l=t(216),d=t.n(l),p=t(589),h=t.n(p),m=t(265),_={};_.styleTagTransform=h(),_.setAttributes=f(),_.insert=c().bind(null,"head"),_.domAPI=o(),_.insertStyleElement=d();var g=a()(m.default,_);if(!m.default.locals||e.hot.invalidate){var v=!m.default.locals,E=v?m:m.default.locals;e.hot.accept(265,(r=>{m=t(265),function(e,r,t){if(!e&&r||e&&!r)return!1;var n;for(n in e)if((!t||"default"!==n)&&e[n]!==r[n])return!1;for(n in r)if(!(t&&"default"===n||e[n]))return!1;return!0}(E,v?m:m.default.locals,v)?(E=v?m:m.default.locals,g(m.default)):e.hot.invalidate()}))}e.hot.dispose((function(){g()})),m.default&&m.default.locals&&m.default.locals},379:e=>{var r=[];function t(e){for(var t=-1,n=0;n<r.length;n++)if(r[n].identifier===e){t=n;break}return t}function n(e,n){for(var i={},o=[],u=0;u<e.length;u++){var c=e[u],s=n.base?c[0]+n.base:c[0],f=i[s]||0,l="".concat(s," ").concat(f);i[s]=f+1;var d=t(l),p={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)r[d].references++,r[d].updater(p);else{var h=a(p,n);n.byIndex=u,r.splice(u,0,{identifier:l,updater:h,references:1})}o.push(l)}return o}function a(e,r){var t=r.domAPI(r);return t.update(e),function(r){if(r){if(r.css===e.css&&r.media===e.media&&r.sourceMap===e.sourceMap&&r.supports===e.supports&&r.layer===e.layer)return;t.update(e=r)}else t.remove()}}e.exports=function(e,a){var i=n(e=e||[],a=a||{});return function(e){e=e||[];for(var o=0;o<i.length;o++){var u=t(i[o]);r[u].references--}for(var c=n(e,a),s=0;s<i.length;s++){var f=t(i[s]);0===r[f].references&&(r[f].updater(),r.splice(f,1))}i=c}}},569:e=>{var r={};e.exports=function(e,t){var n=function(e){if(void 0===r[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}r[e]=t}return r[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(t)}},216:e=>{e.exports=function(e){var r=document.createElement("style");return e.setAttributes(r,e.attributes),e.insert(r,e.options),r}},565:(e,r,t)=>{e.exports=function(e){var r=t.nc;r&&e.setAttribute("nonce",r)}},795:e=>{e.exports=function(e){var r=e.insertStyleElement(e);return{update:function(t){!function(e,r,t){var n="";t.supports&&(n+="@supports (".concat(t.supports,") {")),t.media&&(n+="@media ".concat(t.media," {"));var a=void 0!==t.layer;a&&(n+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),n+=t.css,a&&(n+="}"),t.media&&(n+="}"),t.supports&&(n+="}");var i=t.sourceMap;i&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),r.styleTagTransform(n,e,r.options)}(r,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)}}}},589:e=>{e.exports=function(e,r){if(r.styleSheet)r.styleSheet.cssText=e;else{for(;r.firstChild;)r.removeChild(r.firstChild);r.appendChild(document.createTextNode(e))}}},45:(e,r,t)=>{t.d(r,{l:()=>f}),t(643);var n=function(){function e(){}return e.log=function(e){console.log(e)},e.error=function(e){console.error(e)},e.warn=function(e){console.warn(e)},e}(),a=function(){function e(e){this._listener=[],this._data=e||[]}return e.prototype.addChangeListener=function(e,r){var t=this;if(t._listener.length>0)for(var a=0;a<t._listener.length;a++)if(t._listener[a].fun==e)return void n.warn("监听重复注册");t._listener.push({fun:e,listenerThis:r})},e.prototype.notify=function(e,r,t){var n=this._listener.length;if(0!=n)for(var a=n-1;a>=0;a--){var i=this._listener[a];i.fun.call(i.listenerThis,e,r,t)}},e.prototype.add=function(e){this.setValue(this._data.length,e)},e.prototype.setValue=function(e,r){var t=this,n=t._data[e];t._data[e]=r,t.notify(e,r,n)},e.prototype.getValue=function(e){return this._data[e]},Object.defineProperty(e.prototype,"length",{get:function(){return this._data.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"orginData",{get:function(){return this._data},enumerable:!1,configurable:!0}),e.prototype.getFloat32Array=function(){return new Float32Array(this._data)},e.prototype.getUnit8Array=function(){return new Uint8Array(this._data)},e}(),i=function(){function e(){}return e.bindData=function(e,r,t,n){var i="_$_"+r,o=e[r];o instanceof a&&o.addChangeListener((function(){var a=e[i];e[i]=o,t.call(n,r,e[i],a)}),n),e[i]=o,e.__defineSetter__(r,(function(a){var o=e[i];e[i]=a,t.call(n,r,e[i],o)})),e.__defineGetter__(r,(function(){return e["_$_"+r]}))},e.createCanvas=function(e,r){var t=document.createElement("canvas");return t.width=e,t.height=r,t},e.loadImages=function(r){return Promise.all(r.map((function(t,n){return e.loadOneImg(r[n])})))},e.loadOneImg=function(e){return new Promise((function(r,t){var n=new Image;n.onload=function(){r({name:e.name,img:n})},n.onerror=function(){t("加载错误"+e.src)},n.src=e.src}))},e.random=function(e,r,t){void 0===e&&(e=null),void 0===r&&(r=null),null==e?(e=0,r=1):null==r&&(r=e,e=0);var n=r-e;return t||(t=function(e){return e}),e+t(Math.random())*n},e.range=function(e,r,t){return e<r?r:e>t?t:e},e.chance=function(e){return Math.random()<=e},e.distance=function(e,r){return Math.sqrt((r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y))},e}();const o=t.p+"80993d7a51697f6385323ad00c3440d4.jpg",u=t.p+"ceef2fe61a7579d04362239965b678c2.jpg",c=t.p+"b32dc86f45db9126f4bc5388b41a9486.png",s=t.p+"6e4a2ba0a2b1cad5ab0c19f1f6880324.png";var f,l,d,p=function(e,r,t){if(t||2===arguments.length)for(var n,a=0,i=r.length;a<i;a++)!n&&a in r||(n||(n=Array.prototype.slice.call(r,0,a)),n[a]=r[a]);return e.concat(n||Array.prototype.slice.call(r))},h=function(){function e(e,r,t){this._attribute={},this._indexs={data:null,count:0,buff:null},this._unifrom={},this._cacheImage={},this._dirty=!1,this._sizeChange=!1,this._useFrameBuffer=!1,this._cacheTexture={},this._gl=e,this.initProgram(r,t)}return e.prototype.initProgram=function(e,r){var t=this,a=t._gl;t._program=a.createProgram();var i=t.compileShader(35633,e),o=t.compileShader(35632,r);if(!i||!o)return a.deleteShader(i),a.deleteShader(o),void n.error("ShaderProgram 初始化失败");if(a.attachShader(t._program,i),a.attachShader(t._program,o),a.linkProgram(t._program),a.getProgramParameter(t._program,a.LINK_STATUS));else{var u=a.getProgramInfoLog(t._program);n.error("Shader 链接错误 "+u)}},e.prototype.compileShader=function(e,r){var t=this._gl,a=t.createShader(e);if(a){if(t.shaderSource(a,r),t.compileShader(a),!t.getShaderParameter(a,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(a);return n.error("Shader 编译失败"+i),void t.deleteShader(a)}return a}n.error("Shader 创建失败")},e.prototype.bindData=function(e){var r=this,t=r._gl,i=t.getProgramParameter(r._program,t.ACTIVE_ATTRIBUTES);r._attribute={};for(var o=0;o<i;o++){var u=t.getActiveAttrib(r._program,o),c=u.name;if(e[c]){var s=void 0;if((m=e[c])instanceof a?s=m.getFloat32Array():n.error("顶点着色器中 "+c+" 必须使用GLArray"),_=r.createBuffer(s)){var f=t.getAttribLocation(r._program,c),l=r.getAttributeSize(u.type);r._attribute[c]={location:f,buff:_,count:l},console.log(u)}}else n.error("bindData 没有找到Attribute: "+u.name+" 对应的数组")}var d=t.getProgramParameter(r._program,t.ACTIVE_UNIFORMS);for(o=0;o<d;o++){var p=t.getActiveUniform(r._program,o),h=p.name;if(m=e[h]){if(f=t.getUniformLocation(r._program,h),r._unifrom[h]=r.getUnifromInfo(p,f,m),p.type==t.SAMPLER_2D||p.type==t.SAMPLER_CUBE){if(!m){n.error("bindData 图片格式必须使用字符串"+h);continue}r._unifrom[h].texure=r.createTexture(h,m)}console.log(p)}else n.error("bindData 没有找到Unifrom: "+h+" 对应的数据")}if(e.indexs){var m=e.indexs.getUnit8Array(),_=r.createIndexBuffer(m);r._indexs.buff=_,r._indexs.data=_,r._indexs.count=m.length}r._dirty=!0},e.prototype.render=function(){var e,r=this,t=r._gl;t.useProgram(r._program),r._useFrameBuffer?(t.bindFramebuffer(t.FRAMEBUFFER,r._frameBuffer),t.viewport(0,0,r._frameBufferW,r._frameBufferH),t.clearColor(0,.4,.6,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)):t.viewport(0,0,f.width,f.height),r._sizeChange&&r.handleSizeChange();for(var i=t.getProgramParameter(r._program,t.ACTIVE_ATTRIBUTES),o=0,u=0;u<i;u++){var c=t.getActiveAttrib(r._program,u).name,s=r._attribute[c];t.bindBuffer(t.ARRAY_BUFFER,s.buff),s.changeData&&(t.bufferData(t.ARRAY_BUFFER,s.changeData.getFloat32Array(),t.DYNAMIC_DRAW),s.changeData=null),t.vertexAttribPointer(s.location,s.count,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s.location)}var l=t.getProgramParameter(r._program,t.ACTIVE_UNIFORMS);for(u=0;u<l;u++){var d=t.getActiveUniform(r._program,u);if(s=r._unifrom[d.name],d.type==t.SAMPLER_2D||d.type==t.SAMPLER_CUBE)t.activeTexture(t.TEXTURE0+o),r.renderTexture(s.texure,d.name),s.fun.call(t,s.location,o),o++;else if(s.openParam){var h=s.data;h instanceof a?(e=s.fun).call.apply(e,p([t,s.location],h.orginData,!1)):(n.warn("请检查 unfirom 数据类型是否正确"),s.fun.call(t,s.location,h))}else s.fun.call(t,s.location,s.data)}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r._indexs.buff),r._indexs.changeData&&(s=r._indexs.changeData.getUnit8Array(),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s,t.DYNAMIC_DRAW),r._indexs.changeData=null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r._indexs.data),t.drawElements(t.TRIANGLES,r._indexs.count,t.UNSIGNED_BYTE,0),r._dirty=!1,t.bindTexture(t.TEXTURE_2D,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.useProgram(null)},e.prototype.initFrameBuffer=function(){var e=this,r=e._gl,t=r.createFramebuffer();if(t){var a=r.createTexture();if(a){r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e._frameBufferW,e._frameBufferH,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);var i=r.createRenderbuffer();if(i){r.bindRenderbuffer(r.RENDERBUFFER,i),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e._frameBufferW,e._frameBufferH),r.bindFramebuffer(r.FRAMEBUFFER,t),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,i);var o=r.checkFramebufferStatus(r.FRAMEBUFFER);if(o==r.FRAMEBUFFER_COMPLETE)return r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),{buff:t,texture:a,render:i};n.warn("Frame Buffer is Complete "+o.toString())}else n.warn("渲染缓冲区创建失败")}else n.warn("Frame Buffer 创建纹理失败")}else n.warn("Frame Buffer 创建失败")},e.prototype.enableUseFrameBuffer=function(){var e=this;if(e._useFrameBuffer=!0,e._frameBufferW=f.width,e._frameBufferH=f.height,!e._frameBuffer){var r=e.initFrameBuffer();e._frameBuffer=r.buff,e._frameTexture=r.texture,e._frameRenderBuffer=r.render}},e.prototype.disbaleFrameBuffer=function(){this._useFrameBuffer=!1},e.prototype.frameBufferTexture=function(){return this._frameTexture},e.prototype.resize=function(){var e=this;e._frameBufferW=f.width,e._frameBufferH=f.height,e._sizeChange=!0},e.prototype.handleSizeChange=function(){var e=this,r=e._gl;e._useFrameBuffer&&(r.bindTexture(r.TEXTURE_2D,e._frameTexture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e._frameBufferW,e._frameBufferH,0,r.RGBA,r.UNSIGNED_BYTE,null),r.bindRenderbuffer(r.RENDERBUFFER,e._frameRenderBuffer),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e._frameBufferW,e._frameBufferH),r.bindRenderbuffer(r.RENDERBUFFER,null)),e._sizeChange=!1},e.prototype.renderTexture=function(r,t){var a=this,i=a._gl,o=a._cacheImage[t];if(o)if(o instanceof e){var u=o.frameBufferTexture();u?i.bindTexture(i.TEXTURE_2D,u):n.warn("请确保 shader 中使用WebGL作为图片的 WebGL启用 帧缓存 enableUseFrameBuffer")}else i.bindTexture(i.TEXTURE_2D,r),o instanceof Image&&a._cacheTexture[t]||(a._cacheTexture[t]=r,i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE))},e.prototype.createTexture=function(e,r){var t=this,a=t._gl.createTexture();if(a){if("string"==typeof r){var i=new Image;i.onload=function(){t._cacheImage[e]=i,t._dirty=!0},i.src=r}else t._cacheImage[e]=r;return a}n.error("纹理创建失败")},e.prototype.createBuffer=function(e){var r=this._gl,t=r.createBuffer();if(t)return r.bindBuffer(r.ARRAY_BUFFER,t),r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW),t;n.error("Buffer 创建失败")},e.prototype.createIndexBuffer=function(e){var r=this._gl,t=r.createBuffer();if(t)return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW),t;n.error("Index Buffer 创建失败")},e.prototype.getAttributeSize=function(e){var r=this._gl;switch(e){case r.FLOAT_VEC2:return 2;case r.FLOAT_VEC3:return 3;case r.FLOAT_VEC4:return 4}return 1},e.prototype.getUnifromInfo=function(e,r,t){var n,a=this,i=a._gl,o=!0;switch(e.type){case i.FLOAT:n=i.uniform1f,o=!1;break;case i.FLOAT_VEC2:n=i.uniform2f;break;case i.FLOAT_VEC3:n=i.uniform3f;break;case i.FLOAT_VEC4:n=i.uniform4f;break;case i.INT:case i.BOOL:case i.SAMPLER_2D:case i.SAMPLER_CUBE:n=i.uniform1i,o=!1;break;case i.INT_VEC2:case i.BOOL_VEC2:n=i.uniform2i;break;case i.INT_VEC3:case i.BOOL_VEC3:n=i.uniform3i;break;case i.INT_VEC4:case i.BOOL_VEC4:n=i.uniform4i;break;case i.FLOAT_MAT2:n=a.uniformMatrix2fv,o=!1;break;case i.FLOAT_MAT2:n=a.uniformMatrix3fv,o=!1;break;case i.FLOAT_MAT2:n=a.uniformMatrix4fv,o=!1}return{fun:n,openParam:o,location:r,data:t}},e.prototype.uniformMatrix2fv=function(e,r){this._gl.uniformMatrix2fv(e,!1,r)},e.prototype.uniformMatrix3fv=function(e,r){this._gl.uniformMatrix3fv(e,!1,r)},e.prototype.uniformMatrix4fv=function(e,r){this._gl.uniformMatrix4fv(e,!1,r)},e}(),m=function(){function e(){this.x=0,this.y=0,this.size=0,this.momentum=0,this.shrink=0,this.lastSpawn=0,this.nextSpawn=0,this.killed=!1,this.isNew=!1;var r=this;e.count++,r.killed=!1,r.isNew=!0,r.canvas=i.createCanvas(e.RAIN_SIZE,e.RAIN_SIZE),r.init()}return e.prototype.init=function(){var r=this.canvas.getContext("2d"),t=e.Buff_2dContext,n=e.Buff_Element;t.clearRect(0,0,e.RAIN_SIZE,e.RAIN_SIZE),t.globalCompositeOperation="source-over",t.drawImage(f.getImage("rainColorImage"),0,0,e.RAIN_SIZE,e.RAIN_SIZE),t.globalCompositeOperation="screen",t.fillStyle="rgba(0, 0, 0,1)",t.fillRect(0,0,e.RAIN_SIZE,e.RAIN_SIZE),r.globalCompositeOperation="source-over",r.drawImage(f.getImage("dropAlphaImage"),0,0,e.RAIN_SIZE,e.RAIN_SIZE),r.globalCompositeOperation="source-in",r.drawImage(n,0,0,e.RAIN_SIZE,e.RAIN_SIZE)},e.prototype.set=function(e,r,t){var n=this;n.killed||(n.x=e,n.y=r,n.size=t)},e.prototype.destory=function(){var r=this;r.killed=!0,r.x=0,r.y=0,r.size=0,r.momentum=0,r.shrink=0,r.lastSpawn=0,r.nextSpawn=0,r.parent=null,e._rains.push(r)},e.getRain=function(){var r;return(r=e._rains.length>0?e._rains.pop():new e).killed=!1,r.isNew=!0,r},e.Buff_Element=i.createCanvas(64,64),e.Buff_2dContext=e.Buff_Element.getContext("2d"),e.RAIN_SIZE=64,e.count=0,e._rains=[],e}(),_=function(){function e(e,r,t){this._showRainSizeMult=.2,this._rainYScale=1.5;var n=this;n._width=e,n._height=r,n._options=t,n.canvas=i.createCanvas(e,r),n.canvasCtx=n.canvas.getContext("2d"),n.dropletCanvas=i.createCanvas(e,r),n.dropletCtx=n.dropletCanvas.getContext("2d"),n.init(),n.update()}return e.prototype.init=function(){var e=this;e.rainsTemplate1=[],e.rainsTemplate2=[],e._rains=e.rainsTemplate1,e.dropletTemplate=new m,e._sizeDelt=e._options.rainSize.max-e._options.rainSize.min,e.clearRainCanvas=i.createCanvas(2*m.RAIN_SIZE,2*m.RAIN_SIZE);var r=e.clearRainCanvas.getContext("2d");r.fillStyle="#000",r.beginPath(),r.arc(m.RAIN_SIZE,m.RAIN_SIZE,m.RAIN_SIZE,0,2*Math.PI),r.fill()},e.prototype.resize=function(e,r){var t=this;t.canvasCtx.clearRect(0,0,t._width,t._height),t._width=e,t._height=r,t.canvas.width=e,t.canvas.height=r,t.dropletCanvas.width=e,t.dropletCanvas.height=r},e.prototype.update=function(){var e=this;e.canvasCtx.clearRect(0,0,e._width,e._height),e.updateRain(),requestAnimationFrame(this.update.bind(this))},e.prototype.updateRain=function(){for(var e=this,r=e._options.dropletFrameNum,t=e._options.dropletSize,n=0;n<r;n++)this.drawDroplet(e.dropletCtx,i.random(e._width),i.random(e._height),i.random(t.min,t.max,(function(e){return e*e})));e.canvasCtx.drawImage(e.dropletCanvas,0,0,e._width,e._height);var a=0,o=e._rains==e.rainsTemplate1?e.rainsTemplate2:e.rainsTemplate1;for(o.length=0;i.random()<=.1&&a<1&&(a++,!(e._rains.length>e._options.maxRains));){var u=i.random(e._options.rainSize.min,e._options.rainSize.max,(function(e){return e*e})),c=(Math.floor((u-e._options.rainSize.min)/e._sizeDelt),m.getRain());c.set(i.random(e._width),i.random(e._height),u),e.initMomentum(c),o.push(c)}e._rains.sort((function(r,t){var n=r.y*e._width+r.x,a=t.y*e._height+t.x;return n>a?1:n==a?0:-1})),e._rains.forEach((function(r,t){if(!r.killed){if(i.chance((r.size-e._options.rainSize.min)/e._sizeDelt*.1)&&(r.momentum+=i.random(r.size/e._options.rainSize.max*10)),r.size<e._options.rainSize.min&&i.chance(.05)&&(r.shrink+=.01),r.size-=r.shrink,r.size<=3)return r.killed=!0,void r.destory();if(r.lastSpawn+=r.momentum,r.lastSpawn>r.nextSpawn){var n=m.getRain(),a=r.size*i.random(.2,.5);n.set(r.x+.1*i.random(-r.size,r.size),r.y-.01*r.size,a),e.initMomentum(n),n.parent=r,o.push(n),r.size=r.size-.05*n.size,r.lastSpawn=0,r.nextSpawn=e._options.rainSize.min/5+e._options.rainSize.min/2*1/r.momentum*i.random(2,15)}}if(r.momentum>0&&(r.momentum>40&&console.log(" momentum : "+r.momentum),r.y+=r.momentum,r.y>e._height+r.size))return r.killed=!0,void r.destory();var u=r.momentum>0||r.isNew;if(r.isNew=!1,u&&0==r.killed)for(var c=t+1;c<e._rains.length;c++){var s=e._rains[c];if(s.y>r.size/2+r.y)break;s!=r&&s.size<r.size&&0==s.killed&&s.parent!=r&&r.parent!=s&&i.distance(s,r)<(s.size+r.size)*e._showRainSizeMult&&(r.size>e._options.rainSize.max&&(r.size=e._options.rainSize.max),e._rains.splice(c,1),s.killed=!0,s.destory())}if(r.killed)r.destory();else{e.dropletCtx.globalCompositeOperation="destination-out";var f=r.size*e._showRainSizeMult;e.dropletCtx.drawImage(e.clearRainCanvas,r.x-f,r.y-f*e._rainYScale,2*f,2*f*e._rainYScale),e.canvasCtx.drawImage(r.canvas,r.x-r.size/2,r.y-r.size/2*e._rainYScale,r.size,r.size*e._rainYScale),o.push(r)}}),this),e._rains=o},e.prototype.initMomentum=function(e){e.momentum=1+.1*(e.size-this._options.rainSize.min)+i.random(2)},e.prototype.drawDroplet=function(e,r,t,n){e.globalAlpha=1,e.globalCompositeOperation="source-over",e.drawImage(this.dropletTemplate.canvas,r-1*n,t-1.5*n,2*n*1,2*n*1.5)},e}(),g=function(){function e(){this._programs=[],this.imgDic={},this._size=new a([800,800]),this._options={rainSize:{min:50,max:120},maxRains:100,dropletSize:{min:2.5,max:5.5},dropletFrameNum:20}}return e.prototype.run=function(e){var r=this,t=this;t._mainCanvas=e;var n=t._mainCanvas.getContext("webgl");this._gl=n;var a=[{name:"bgImage",src:o},{name:"dropAlphaImage",src:c},{name:"rainColorImage",src:s}];i.loadImages(a).then((function(e){for(var n=0;n<e.length;n++)r.imgDic[e[n].name]=e[n].img;t.start()}))},e.prototype.start=function(){var e=this,r=e._gl;e._size.setValue(0,e._mainCanvas.width),e._size.setValue(1,e._mainCanvas.height),r.viewport(0,0,e._mainCanvas.width,e._mainCanvas.height);var t=new h(r,"attribute vec2 aPos;\r\nattribute vec2 aUv;\r\nvarying vec2 vUv;\r\n\r\nvoid main(){\r\n    vUv = aUv;\r\n    gl_Position = vec4(aPos, 0.0, 1.0);\r\n}","precision mediump float;\r\nuniform sampler2D uBgSampler;\r\nuniform sampler2D uRainSampler;\r\nuniform vec2 uSize;\r\n\r\n/**将两种颜色进行混合 */\r\nvec4 blend(vec4 bg,vec4 fg){\r\n  vec3 bgm=bg.rgb*bg.a;\r\n  vec3 fgm=fg.rgb*fg.a;\r\n  float ia=1.0-fg.a;\r\n  float a=(fg.a + bg.a * ia);\r\n  vec3 rgb;\r\n  if(a!=0.0){\r\n    rgb=(fgm + bgm * ia) / a;\r\n  }else{\r\n    rgb=vec3(0.0,0.0,0.0);\r\n  }\r\n  return vec4(rgb,a);\r\n}\r\n//根据当前的像素位置，转换成0-1的uv坐标\r\nvec2 texCoord(){\r\n    return vec2(gl_FragCoord.x, uSize.y - gl_FragCoord.y)/uSize;\r\n}\r\n\r\n\r\nvoid main(){\r\n    vec2 uv = texCoord();//当前屏幕像素的位置\r\n    vec4 bg = texture2D(uBgSampler, uv);//0-1\r\n    // vec4 bg = vec4(1.0, 0.0, 0.0, 1.0);//0-1\r\n    vec4 rain = texture2D(uRainSampler, uv);\r\n    \r\n    vec2 refraction = (vec2(rain.g, rain.r) - 0.5)*2.0;//转换成 剪裁坐标 -1~1\r\n    vec2 refractionPos = uv + (1.0/uSize * refraction *(256.0 + (rain.b * 256.0)));//当前uv+ (折射像素的范围)/宽高 * rain中g,r的位置(-1,1)\r\n\r\n    vec4 tex = texture2D(uBgSampler, refractionPos);\r\n\r\n    vec4 fg = vec4(tex.rgb * 1.04, clamp(rain.a*6.0-3.0, 0.0, 1.0));//rgb*1.04 对水珠提亮，  clamp(a*6-3) 对alpha进行过滤 0-0.5（3/6)部分滤掉， 0.5-0.6[3/6-(3+1)/6]部分显示透明度，0.6之后显示1\r\n\r\n    gl_FragColor = blend(bg, fg);\r\n}");e._rainDrop=new _(e.width,e.height,e._options);var n=new h(r,"\r\nattribute vec2 aPos;\r\nvoid main(){\r\n    gl_Position = vec4(aPos, 0.0, 1.0);\r\n}","precision mediump float;\r\nuniform sampler2D uBgSampler;\r\nuniform vec2 uSize;\r\n\r\n//根据当前的像素位置，转换成0-1的uv坐标\r\nvec2 texCoord(){\r\n    return vec2(gl_FragCoord.x,  gl_FragCoord.y)/uSize;\r\n}\r\nvoid main(){\r\n    vec4 color = texture2D(uBgSampler, texCoord());\r\n\tgl_FragColor = vec4(color.rgb, 1.0);\r\n}"),i={aPos:new a([-1,1,-1,-1,1,-1,1,1]),uBgSampler:u,uSize:e._size,indexs:new a([0,1,2,0,2,3])};n.bindData(i),n.enableUseFrameBuffer(),this._programs.push(n),this._programs.push(n),e._rainShaderData={aPos:new a([-1,1,-1,-1,1,-1,1,1]),aUv:new a([0,1,0,0,1,0,1,1]),uBgSampler:n,uRainSampler:e._rainDrop.canvas,uSize:e._size,indexs:new a([0,1,2,0,2,3])},t.bindData(e._rainShaderData),this._programs.push(t),this.update()},e.prototype.resize=function(e,r){var t=this;t._size.setValue(0,e),t._size.setValue(1,r),t._mainCanvas.width=t.width,t._mainCanvas.height=t.height,t._gl&&t._gl.viewport(0,0,t.width,t.height),t._rainDrop&&t._rainDrop.resize(t.width,t.height);for(var n=0;n<t._programs.length;n++)t._programs[n].resize()},e.prototype.update=function(){var e=this,r=function(){for(var t=0;t<e._programs.length;t++)e._programs[t].render();requestAnimationFrame(r)};requestAnimationFrame(r)},e.prototype.getImage=function(e){return this.imgDic[e]},Object.defineProperty(e.prototype,"width",{get:function(){return this._size.getValue(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._size.getValue(1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rainOptions",{get:function(){return this._options},enumerable:!1,configurable:!0}),e}();function v(){console.log("触发resize"),f&&f.resize(window.document.body.clientWidth,window.document.body.clientHeight)}window.onload=function(){(f=new g).run(document.getElementById("webgl")),v()},window.onresize=(l=v,200,d=null,function(){null!=d&&clearTimeout(d),d=setTimeout(l,200)})}},n={};function a(e){var r=n[e];if(void 0!==r){if(void 0!==r.error)throw r.error;return r.exports}var i=n[e]={id:e,exports:{}};try{var o={id:e,module:i,factory:t[e],require:a};a.i.forEach((function(e){e(o)})),i=o.module,o.factory.call(i.exports,i,i.exports,o.require)}catch(e){throw i.error=e,e}return i.exports}a.m=t,a.c=n,a.i=[],a.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return a.d(r,{a:r}),r},a.d=(e,r)=>{for(var t in r)a.o(r,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},a.hu=e=>e+"."+a.h()+".hot-update.js",a.hmrF=()=>"app."+a.h()+".hot-update.json",a.h=()=>"57a0f45da1231129f5bd",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),e={},r="testwarte:",a.l=(t,n,i,o)=>{if(e[t])e[t].push(n);else{var u,c;if(void 0!==i)for(var s=document.getElementsByTagName("script"),f=0;f<s.length;f++){var l=s[f];if(l.getAttribute("src")==t||l.getAttribute("data-webpack")==r+i){u=l;break}}u||(c=!0,(u=document.createElement("script")).charset="utf-8",u.timeout=120,a.nc&&u.setAttribute("nonce",a.nc),u.setAttribute("data-webpack",r+i),u.src=t),e[t]=[n];var d=(r,n)=>{u.onerror=u.onload=null,clearTimeout(p);var a=e[t];if(delete e[t],u.parentNode&&u.parentNode.removeChild(u),a&&a.forEach((e=>e(n))),r)return r(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:u}),12e4);u.onerror=d.bind(null,u.onerror),u.onload=d.bind(null,u.onload),c&&document.head.appendChild(u)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e,r,t,n,i={},o=a.c,u=[],c=[],s="idle";function f(e){s=e;for(var r=[],t=0;t<c.length;t++)r[t]=c[t].call(null,e);return Promise.all(r)}function l(e){if(0===r.length)return e();var t=r;return r=[],Promise.all(t).then((function(){return l(e)}))}function d(e){if("idle"!==s)throw new Error("check() is only allowed in idle status");return f("check").then(a.hmrM).then((function(n){return n?f("prepare").then((function(){var i=[];return r=[],t=[],Promise.all(Object.keys(a.hmrC).reduce((function(e,r){return a.hmrC[r](n.c,n.r,n.m,e,t,i),e}),[])).then((function(){return l((function(){return e?h(e):f("ready").then((function(){return i}))}))}))})):f(m()?"ready":"idle").then((function(){return null}))}))}function p(e){return"ready"!==s?Promise.resolve().then((function(){throw new Error("apply() is only allowed in ready status")})):h(e)}function h(e){e=e||{},m();var r=t.map((function(r){return r(e)}));t=void 0;var a=r.map((function(e){return e.error})).filter(Boolean);if(a.length>0)return f("abort").then((function(){throw a[0]}));var i=f("dispose");r.forEach((function(e){e.dispose&&e.dispose()}));var o,u=f("apply"),c=function(e){o||(o=e)},s=[];return r.forEach((function(e){if(e.apply){var r=e.apply(c);if(r)for(var t=0;t<r.length;t++)s.push(r[t])}})),Promise.all([i,u]).then((function(){return o?f("fail").then((function(){throw o})):n?h(e).then((function(e){return s.forEach((function(r){e.indexOf(r)<0&&e.push(r)})),e})):f("idle").then((function(){return s}))}))}function m(){if(n)return t||(t=[]),Object.keys(a.hmrI).forEach((function(e){n.forEach((function(r){a.hmrI[e](r,t)}))})),n=void 0,!0}a.hmrD=i,a.i.push((function(h){var m,_,g,v,E=h.module,b=function(t,n){var a=o[n];if(!a)return t;var i=function(r){if(a.hot.active){if(o[r]){var i=o[r].parents;-1===i.indexOf(n)&&i.push(n)}else u=[n],e=r;-1===a.children.indexOf(r)&&a.children.push(r)}else console.warn("[HMR] unexpected require("+r+") from disposed module "+n),u=[];return t(r)},c=function(e){return{configurable:!0,enumerable:!0,get:function(){return t[e]},set:function(r){t[e]=r}}};for(var d in t)Object.prototype.hasOwnProperty.call(t,d)&&"e"!==d&&Object.defineProperty(i,d,c(d));return i.e=function(e){return function(e){switch(s){case"ready":return f("prepare"),r.push(e),l((function(){return f("ready")})),e;case"prepare":return r.push(e),e;default:return e}}(t.e(e))},i}(h.require,h.id);E.hot=(m=h.id,_=E,v={_acceptedDependencies:{},_acceptedErrorHandlers:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_selfInvalidated:!1,_disposeHandlers:[],_main:g=e!==m,_requireSelf:function(){u=_.parents.slice(),e=g?void 0:m,a(m)},active:!0,accept:function(e,r,t){if(void 0===e)v._selfAccepted=!0;else if("function"==typeof e)v._selfAccepted=e;else if("object"==typeof e&&null!==e)for(var n=0;n<e.length;n++)v._acceptedDependencies[e[n]]=r||function(){},v._acceptedErrorHandlers[e[n]]=t;else v._acceptedDependencies[e]=r||function(){},v._acceptedErrorHandlers[e]=t},decline:function(e){if(void 0===e)v._selfDeclined=!0;else if("object"==typeof e&&null!==e)for(var r=0;r<e.length;r++)v._declinedDependencies[e[r]]=!0;else v._declinedDependencies[e]=!0},dispose:function(e){v._disposeHandlers.push(e)},addDisposeHandler:function(e){v._disposeHandlers.push(e)},removeDisposeHandler:function(e){var r=v._disposeHandlers.indexOf(e);r>=0&&v._disposeHandlers.splice(r,1)},invalidate:function(){switch(this._selfInvalidated=!0,s){case"idle":t=[],Object.keys(a.hmrI).forEach((function(e){a.hmrI[e](m,t)})),f("ready");break;case"ready":Object.keys(a.hmrI).forEach((function(e){a.hmrI[e](m,t)}));break;case"prepare":case"check":case"dispose":case"apply":(n=n||[]).push(m)}},check:d,apply:p,status:function(e){if(!e)return s;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var r=c.indexOf(e);r>=0&&c.splice(r,1)},data:i[m]},e=void 0,v),E.parents=u,E.children=[],u=[],h.require=b})),a.hmrC={},a.hmrI={}})(),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var r=a.g.document;if(!e&&r&&(r.currentScript&&(e=r.currentScript.src),!e)){var t=r.getElementsByTagName("script");t.length&&(e=t[t.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e,r,t,n,i=a.hmrS_jsonp=a.hmrS_jsonp||{143:0},o={};function u(e){return new Promise(((r,t)=>{o[e]=r;var n=a.p+a.hu(e),i=new Error;a.l(n,(r=>{if(o[e]){o[e]=void 0;var n=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;i.message="Loading hot update chunk "+e+" failed.\n("+n+": "+a+")",i.name="ChunkLoadError",i.type=n,i.request=a,t(i)}}))}))}function c(o){function u(e){for(var r=[e],t={},n=r.map((function(e){return{chain:[e],id:e}}));n.length>0;){var i=n.pop(),o=i.id,u=i.chain,s=a.c[o];if(s&&(!s.hot._selfAccepted||s.hot._selfInvalidated)){if(s.hot._selfDeclined)return{type:"self-declined",chain:u,moduleId:o};if(s.hot._main)return{type:"unaccepted",chain:u,moduleId:o};for(var f=0;f<s.parents.length;f++){var l=s.parents[f],d=a.c[l];if(d){if(d.hot._declinedDependencies[o])return{type:"declined",chain:u.concat([l]),moduleId:o,parentId:l};-1===r.indexOf(l)&&(d.hot._acceptedDependencies[o]?(t[l]||(t[l]=[]),c(t[l],[o])):(delete t[l],r.push(l),n.push({chain:u.concat([l]),id:l})))}}}}return{type:"accepted",moduleId:e,outdatedModules:r,outdatedDependencies:t}}function c(e,r){for(var t=0;t<r.length;t++){var n=r[t];-1===e.indexOf(n)&&e.push(n)}}a.f&&delete a.f.jsonpHmr,e=void 0;var s={},f=[],l={},d=function(e){console.warn("[HMR] unexpected require("+e.id+") to disposed module")};for(var p in r)if(a.o(r,p)){var h,m=r[p],_=!1,g=!1,v=!1,E="";switch((h=m?u(p):{type:"disposed",moduleId:p}).chain&&(E="\nUpdate propagation: "+h.chain.join(" -> ")),h.type){case"self-declined":o.onDeclined&&o.onDeclined(h),o.ignoreDeclined||(_=new Error("Aborted because of self decline: "+h.moduleId+E));break;case"declined":o.onDeclined&&o.onDeclined(h),o.ignoreDeclined||(_=new Error("Aborted because of declined dependency: "+h.moduleId+" in "+h.parentId+E));break;case"unaccepted":o.onUnaccepted&&o.onUnaccepted(h),o.ignoreUnaccepted||(_=new Error("Aborted because "+p+" is not accepted"+E));break;case"accepted":o.onAccepted&&o.onAccepted(h),g=!0;break;case"disposed":o.onDisposed&&o.onDisposed(h),v=!0;break;default:throw new Error("Unexception type "+h.type)}if(_)return{error:_};if(g)for(p in l[p]=m,c(f,h.outdatedModules),h.outdatedDependencies)a.o(h.outdatedDependencies,p)&&(s[p]||(s[p]=[]),c(s[p],h.outdatedDependencies[p]));v&&(c(f,[h.moduleId]),l[p]=d)}r=void 0;for(var b,y=[],R=0;R<f.length;R++){var T=f[R],A=a.c[T];A&&(A.hot._selfAccepted||A.hot._main)&&l[T]!==d&&!A.hot._selfInvalidated&&y.push({module:T,require:A.hot._requireSelf,errorHandler:A.hot._selfAccepted})}return{dispose:function(){var e;t.forEach((function(e){delete i[e]})),t=void 0;for(var r,n=f.slice();n.length>0;){var o=n.pop(),u=a.c[o];if(u){var c={},l=u.hot._disposeHandlers;for(R=0;R<l.length;R++)l[R].call(null,c);for(a.hmrD[o]=c,u.hot.active=!1,delete a.c[o],delete s[o],R=0;R<u.children.length;R++){var d=a.c[u.children[R]];d&&(e=d.parents.indexOf(o))>=0&&d.parents.splice(e,1)}}}for(var p in s)if(a.o(s,p)&&(u=a.c[p]))for(b=s[p],R=0;R<b.length;R++)r=b[R],(e=u.children.indexOf(r))>=0&&u.children.splice(e,1)},apply:function(e){for(var r in l)a.o(l,r)&&(a.m[r]=l[r]);for(var t=0;t<n.length;t++)n[t](a);for(var i in s)if(a.o(s,i)){var u=a.c[i];if(u){b=s[i];for(var c=[],d=[],p=[],h=0;h<b.length;h++){var m=b[h],_=u.hot._acceptedDependencies[m],g=u.hot._acceptedErrorHandlers[m];if(_){if(-1!==c.indexOf(_))continue;c.push(_),d.push(g),p.push(m)}}for(var v=0;v<c.length;v++)try{c[v].call(null,b)}catch(r){if("function"==typeof d[v])try{d[v](r,{moduleId:i,dependencyId:p[v]})}catch(t){o.onErrored&&o.onErrored({type:"accept-error-handler-errored",moduleId:i,dependencyId:p[v],error:t,originalError:r}),o.ignoreErrored||(e(t),e(r))}else o.onErrored&&o.onErrored({type:"accept-errored",moduleId:i,dependencyId:p[v],error:r}),o.ignoreErrored||e(r)}}}for(var E=0;E<y.length;E++){var R=y[E],T=R.module;try{R.require(T)}catch(r){if("function"==typeof R.errorHandler)try{R.errorHandler(r,{moduleId:T,module:a.c[T]})}catch(t){o.onErrored&&o.onErrored({type:"self-accept-error-handler-errored",moduleId:T,error:t,originalError:r}),o.ignoreErrored||(e(t),e(r))}else o.onErrored&&o.onErrored({type:"self-accept-errored",moduleId:T,error:r}),o.ignoreErrored||e(r)}}return f}}}self.webpackHotUpdatetestwarte=(e,t,i)=>{for(var u in t)a.o(t,u)&&(r[u]=t[u]);i&&n.push(i),o[e]&&(o[e](),o[e]=void 0)},a.hmrI.jsonp=function(e,i){r||(r={},n=[],t=[],i.push(c)),a.o(r,e)||(r[e]=a.m[e])},a.hmrC.jsonp=function(o,s,f,l,d,p){d.push(c),e={},t=s,r=f.reduce((function(e,r){return e[r]=!1,e}),{}),n=[],o.forEach((function(r){a.o(i,r)&&void 0!==i[r]&&(l.push(u(r)),e[r]=!0)})),a.f&&(a.f.jsonpHmr=function(r,t){e&&!a.o(e,r)&&a.o(i,r)&&void 0!==i[r]&&(t.push(u(r)),e[r]=!0)})},a.hmrM=()=>{if("undefined"==typeof fetch)throw new Error("No browser support: need fetch API");return fetch(a.p+a.hmrF()).then((e=>{if(404!==e.status){if(!e.ok)throw new Error("Failed to fetch update manifest "+e.statusText);return e.json()}}))}})(),a(45)})();